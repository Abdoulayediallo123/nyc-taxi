-- HOW MANY TRIPS OCCURE PER HOUR?
SELECT  
    DATEPART(HOUR, PICKUP_DATETIME) AS PICKUP_HOUR,
    COUNT(*) AS TOTAL_TRIPS
    FROM STAGE.NYC_TAXI
    GROUP BY DATEPART(HOUR, PICKUP_DATETIME)
    ORDER BY PICKUP_HOUR;

-- DETERMININING HOW MANY TRIPS OCCURE A DAY?

SELECT 
    CAST(PICKUP_DATETIME AS DATE) AS TRIP_DATE,
    COUNT(*) AS TOTAL_TRIP
FROM 
    STAGE.NYC_TAXI 
GROUP BY CAST(PICKUP_DATETIME AS DATE)
ORDER BY TRIP_DATE;

-- DETEMINING HOW MANY TRIPS OCCURE A WEEK.   
SELECT 
    DATEPART(WEEK, PICKUP_DATETIME) AS TRIP_BY_WEEK,   
    COUNT(*) AS TOTAL_TRIP
FROM STAGE.NYC_TAXI
GROUP BY 
 DATEPART(WEEK, PICKUP_DATETIME)
ORDER BY TRIP_BY_WEEK; 

-- DETEMINING HOW MANY TRIPS A MOUNTH.
SELECT 
    DATEPART(MONTH, PICKUP_DATETIME) AS TRIP_BY_MONTH,
    COUNT(*) AS TOTAL_TRIP_A_MONTH
FROM STAGE.NYC_TAXI 
GROUP BY DATEPART(MONTH, PICKUP_DATETIME)
ORDER BY TRIP_BY_MONTH; 

-- DETERMINING THE BUSIEST DAYS
SELECT
    CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
    DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE)) AS DAY_OF_THE_WEEK,
    COUNT(*) AS TRIP_COUNT
FROM STAGE.NYC_TAXI
GROUP BY CAST(PICKUP_DATETIME AS DATE)
ORDER BY TRIP_COUNT DESC;

-- DETERMINING THE TOTAL AMOUNT MADE IN 2024 
SELECT SUM(CAST(TOTAL_AMOUNT AS FLOAT)) AS TOTAL_AMOUNT
FROM STAGE.NYC_TAXI;

-- What are the rush hour trends (weekday vs. weekend)?
SELECT
CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE)) AS PICKUP_DAY,
CONCAT(DATEPART(HOUR, PICKUP_DATETIME), ' hr') AS PICKUP_TIME,
COUNT(*) AS NUMBER_OF_TRIP
FROM STAGE.NYC_TAXI
GROUP BY 
CAST(PICKUP_DATETIME AS DATE),
DATEPART(HOUR, PICKUP_DATETIME),
DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE))
ORDER BY NUMBER_OF_TRIP DESC;

-- How do trips distances and fares vary by time of day?
SELECT  
CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE)) AS WEEK_DAY,
CAST(PICKUP_DATETIME AS TIME) AS PICKUP_TIME,
TRIP_DISTANCE,
TOTAL_AMOUNT
FROM STAGE.NYC_TAXI;

-- Which months have the most rides?
SELECT 
CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
DATENAME(MONTH, PICKUP_DATETIME) AS MONTH_OF_PICKUP,
COUNT(*) AS TOTAL_PICKUP
FROM STAGE.NYC_TAXI
GROUP BY 
CAST(PICKUP_DATETIME AS DATE),
DATENAME(MONTH, PICKUP_DATETIME)
ORDER BY TOTAL_PICKUP DESC;

-- What’s the distribution of payment methods (cash, card)?
------ Card
SELECT 
PICKUP_DATETIME,
PASSENGER_COUNT,
TRIP_DISTANCE,
FARE_AMOUNT,
TIP_AMOUNT,
TOTAL_AMOUNT,
PAYMENT_TYPE
FROM STAGE.NYC_TAXI
WHERE PAYMENT_TYPE LIKE 'CRD'
ORDER BY TIP_AMOUNT DESC;

-- Cash
SELECT
PICKUP_DATETIME,
PASSENGER_COUNT,
TRIP_DISTANCE,
FARE_AMOUNT,
TIP_AMOUNT,
TOTAL_AMOUNT,
PAYMENT_TYPE
FROM STAGE.NYC_TAXI
WHERE PAYMENT_TYPE LIKE 'CSH'
ORDER BY TIP_AMOUNT DESC;

--------------------------------------------------------------------------------
--------------   CREATING VIEWS FOR THE VISUALIZATION                ----------
--------------------------------------------------------------------------------
-- HOURLY PICKUP
GO
CREATE VIEW HOURLY_PICKUP_COUNTs AS 
SELECT  
    DATEPART(HOUR, PICKUP_DATETIME) AS PICKUP_HOUR,
    COUNT(*) AS TOTAL_TRIPS
FROM STAGE.NYC_TAXI
GROUP BY DATEPART(HOUR, PICKUP_DATETIME);

-- TRIPS THAT OCCURE A DAY?
GO
CREATE VIEW DALY_TRIP_COUNTs AS
SELECT 
    CAST(PICKUP_DATETIME AS DATE) AS TRIP_DATE,
    COUNT(*) AS TOTAL_TRIP
FROM 
    STAGE.NYC_TAXI 
GROUP BY CAST(PICKUP_DATETIME AS DATE)

-- TRIPS THAT OCCURE A WEEK.
GO
CREATE VIEW WEEKLY_TRIP_COUNTs AS
SELECT 
    DATEPART(WEEK, PICKUP_DATETIME) AS TRIP_BY_WEEK,
    COUNT(*) AS TOTAL_TRIP
FROM STAGE.NYC_TAXI
GROUP BY  DATEPART(WEEK, PICKUP_DATETIME);

-- TRIPS BY MONTH.
GO
CREATE VIEW MONTHLY_TRIPS_COUNTs AS
SELECT 
    DATEPART(MONTH, PICKUP_DATETIME) AS TRIP_BY_MONTH,
    COUNT(*) AS TOTAL_TRIP_A_MONTH
FROM STAGE.NYC_TAXI 
GROUP BY DATEPART(MONTH, PICKUP_DATETIME)

-- BUSIEST DAYS
GO
CREATE VIEW BUSIEST_DAYs AS
SELECT
    CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
    DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE)) AS DAY_OF_THE_WEEK,
    COUNT(*) AS TRIP_COUNT
FROM STAGE.NYC_TAXI
GROUP BY CAST(PICKUP_DATETIME AS DATE);

-- What are the rush hour trends (weekday vs. weekend)?
GO
CREATE VIEW RUSH_HOUR_TRENDSs AS
SELECT
CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE)) AS PICKUP_DAY,
CONCAT(DATEPART(HOUR, PICKUP_DATETIME), ' hr') AS PICKUP_TIME,
COUNT(*) AS NUMBER_OF_TRIP
FROM STAGE.NYC_TAXI
GROUP BY 
CAST(PICKUP_DATETIME AS DATE),
DATEPART(HOUR, PICKUP_DATETIME),
DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE));

-- trips distances and fares vary by time of day?
GO
CREATE VIEW TRIPS_DISTANCE_AND_FARE AS
SELECT  
CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
DATENAME(WEEKDAY, CAST(PICKUP_DATETIME AS DATE)) AS WEEK_DAY,
CAST(PICKUP_DATETIME AS TIME) AS PICKUP_TIME,
TRIP_DISTANCE,
TOTAL_AMOUNT
FROM STAGE.NYC_TAXI;

-- Months that have the most rides?
GO
CREATE VIEW MONTHS_WITH_MORE_TRIP AS
SELECT 
CAST(PICKUP_DATETIME AS DATE) AS PICKUP_DATE,
DATENAME(MONTH, PICKUP_DATETIME) AS MONTH_OF_PICKUP,
COUNT(*) AS TOTAL_PICKUP
FROM STAGE.NYC_TAXI
GROUP BY 
CAST(PICKUP_DATETIME AS DATE),
DATENAME(MONTH, PICKUP_DATETIME);

-- What’s the distribution of payment methods (cash, card)?
------ Card
GO
CREATE VIEW PAYMENT_BY_CARDS AS
SELECT 
PICKUP_DATETIME,
PASSENGER_COUNT,
TRIP_DISTANCE,
FARE_AMOUNT,
TIP_AMOUNT,
TOTAL_AMOUNT,
PAYMENT_TYPE
FROM STAGE.NYC_TAXI
WHERE PAYMENT_TYPE LIKE 'CRD';

-- Cash
GO
CREATE VIEW PAYMENT_BY_CASHS AS
SELECT
PICKUP_DATETIME,
PASSENGER_COUNT,
TRIP_DISTANCE,
FARE_AMOUNT,
TIP_AMOUNT,
TOTAL_AMOUNT,
PAYMENT_TYPE
FROM STAGE.NYC_TAXI
WHERE PAYMENT_TYPE LIKE 'CSH';
GO




